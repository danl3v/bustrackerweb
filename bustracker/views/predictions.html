{% extends "base.html" %}

{% block extrahead %}
<script src="/js/jquery.js" type="text/javascript"></script>
<script src="/js/jquery.tmpl.js" type="text/javascript"></script>
<script src="/js/knockout.js" type="text/javascript"></script>
<script src="/js/clock.js" type="text/javascript"></script>
{% if show_news_feed != 'no' %}
<script>
newsFeedWidth = {{ news_feed_width }};
$(document).ready(function() {
	getPosts();
});
</script>
{% endif %}
<script>
$(document).ready(function() {
	{% if show_banner %}setTimeout(hideBanner, 500);{% else %}$('#wrapper').fadeIn('slow');{% endif %}
});
</script>
{% endblock %}

{% block extrahtml %}{% if show_banner %}<div id="banner"><p style="padding-top: 20%;">{{ show_banner }}</p></div>{% endif %}{% endblock %}

{% block content %}
{% if show_news_feed != 'no' %}<div id="news-feed-background"></div><div id="divider"></div>{% endif %}
<div id="header"><p>Transit Arrival Times</p><span id="clock">&nbsp;</span></div>

<div id="main">
	{% if show_news_feed != 'no' %}
	<div id="container">
		<div id="stop-list-container">
			<table id="stop-list" class="list" data-bind="template: 'stopTemplate'"></table>
		</div>
		<div id="news-feed-list-container">
			<table id="news-feed-list" class="list">
				<tr class="header1"><td class="header1-left">Loading news feed...</td></tr>
			</table>
		</div>
	</div>
	{% else %}
	<table id="stop-list" class="list">
		<table id="stop-list" class="list" data-bind="template:'stopTemplate'"></table>
	</table>
	{% endif %}
</div>

<div class="new-stop-form" style="position: absolute; top: 20%; left: 30%; z-index: 9999;" data-bind="visible: editingStop()">
	<form>
		<h1 data-bind="text: editingStop().title"></h1>
		<p>edit stop</p>
		
		<label>Stop Title:
		<span class="small">your personal description</span>
		</label>
		<input type="text" name="title" class="title" id="title" placeholder="e.g. Line 18 at Everett to Downtown Oakland" data-bind="value: editingStop().title">
		
		<label>Your origin:
		<span class="small">use the menus</span>
		</label>
		<div class="select-set">
		<select name="agency-select" id="agency-select" data-bind="options: editingStop().agencyChoices, optionsText: 'title', value: editingStop().agencyChoice, optionsCaption: 'Select a transit agency...'"></select>
		
		<div id="nextbus-menus" data-bind="visible: editingStop().agencyTag != 'bart'">
		<select name="nextbus-line-select" id="nextbus-line-select" data-bind="options: editingStop().lineChoices, optionsText: 'title', value: editingStop().lineChoice, optionsCaption: 'Select a line...', enable: editingStop().agencyChoice"></select>
		<select name="nextbus-direction-select" id="nextbus-direction-select" data-bind="options: editingStop().directionChoices, optionsText: 'title', value: editingStop().directionChoice, optionsCaption: 'Select a direction...', enable: editingStop().lineChoice"></select>
		<select name="nextbus-stop-select" id="nextbus-stop-select" data-bind="options: editingStop().stopChoices, optionsText: 'title', value: editingStop().stopChoice, optionsCaption: 'Select a stop...', enable: editingStop().directionChoice"></select>
		</div>
		<!--<div id="bart-menus" data-bind="visible: editingStop().agencyTag == 'bart'">
		<select name="bart-station-select" id="bart-station-select"></select>
		<select name="bart-direction-select" id="bart-direction-select"></select>
		</div>-->
		</div>
		
		<label>Time to Get to Stop:
		<span class="small">this is your estimation in minutes</span>
		</label>
		<input type="text" name="time-to-stop" id="time-to-stop" placeholder="e.g. 12" data-bind="value: editingStop().timeToStop">

		<div id="buttons">
		<button id="cancelButton" data-bind="click: function() { vm.cancelEditingStop() }">Cancel</button>
		<button id="doneButton" data-bind="click: function() { vm.doneEditingStop() }">Done</button>
		</div>
	</form>
</div>

<div id="fade" data-bind="visible: editingStop, click: function() { vm.cancelEditingStop() }"></div>

{% verbatim %}

<script type="text/x-jquery-tmpl" id="stopTemplate">
	{{if stops().length == 0}}
		{{if vm.isLoading()}}<tr class="header1"><td class="header1-left">${isLoading}Loading...</td></tr>{{/if}}
		{{if !vm.isLoading()}}<tr class="header1"><td class="header1-left">No stops. <a href="#" onclick="vm.newStop()">Add one!</a>.</td></tr>{{/if}}
	{{/if}}
	{{each(i, stop) stops()}}
		<tr class="header1">
			<td class="header1-left">${title}</td>
			<td class="header1-right">
				{{if i > 0}}<button data-bind="click: function() { vm.moveup(i) }">move up</button>{{/if}}
				{{if i < vm.stops().length-1}}<button data-bind="click: function() { vm.movedown(i) }">move down</button>{{/if}}
				<button data-bind="click: function() { vm.editStop(i) }">edit</button>
				<button data-bind="click: function() { vm.delete(i) }">delete</button>
			</td>
		</tr>
		{{if directions().length == 0}}
			<tr class="header3"><td class="header3-left" colspan="2">loading...</td></tr>
		{{/if}}
		{{each(j, direction) directions()}}
			{{if title}}<tr class="header2"><td class="header2-left" colspan="2">${title}</td></tr>{{/if}}
			{{each(k, destination) destinations()}}
				<tr class="header3"><td class="header3-left" colspan="2">${title}</td></tr>
				{{if vehicles().length == 0}}
					<tr class="header4"><td class="header4-left">no vehicles predicted</td><td class="header4-right"></td></tr>
				{{/if}}
				{{each(l, vehicle) vehicles()}}
					<tr class="header4"><td class="header4-left"><span class="big">${minutes}</span> minutes</td><td class="header4-right">${prettyTimeToLeave}</td></tr>
				{{/each}}
			{{/each}}
		{{/each}}
	{{/each}}
</script>

{% endverbatim %} 

<script src="/js/model.js" type="text/javascript"></script>
<script src="/js/predictions_layout.js" type="text/javascript"></script>

{% endblock %}